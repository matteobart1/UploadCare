<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload your product images</title>

  <!-- Uploadcare Widget -->
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>

  <script>
    // Leggi il session_id dall'URL
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    const sessionId = getQueryParam('session_id') || 'unknown';

    // Configura Uploadcare
    UPLOADCARE_PUBLIC_KEY = 'b50db034602961a73c98'; // <-- Sostituisci con la tua vera chiave
    UPLOADCARE_LOCALE = 'en';

    const widget = uploadcare.Widget('[role=uploadcare-uploader]');

    // ⛔ Disattiva upload automatico
    uploadcare.start = false;

    // ✅ Appena l'utente seleziona un file
    widget.onChange(file => {
      file.setMetadata({ session_id: sessionId }).then(updatedFile => {
        updatedFile.store(); // forza il salvataggio con metadata
      });
    });
  </script>

  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
    }
    h2 {
      margin-bottom: 1em;
    }
  </style>
</head>

<body>
  <h2>Upload your product images</h2>

  <input
    type="hidden"
    role="uploadcare-uploader"
    data-multiple="true"
    data-tabs="file camera url"
    data-public-key="b50db034602961a73c98"
    data-path-value="true"
  />
</body>
</html>